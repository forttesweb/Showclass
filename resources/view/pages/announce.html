<style>
    textarea {
        background: #fafafa;
        border: 1px solid #f2f2f2;
        box-shadow: 0px 5px 6px rgb(0 0 0 / 25%);
        border-radius: 8px;
        width: 100%;
    }

    .area-upload {
        box-shadow: 0 5px 20px rgba(0, 0, 0, .2);
        /* margin: 20px auto; */
        /* padding: 20px; */
        box-sizing: border-box;
        width: 100%;
        max-width: 700px;
        position: relative;
        height: 326px;
    }

    .area-upload label.label-upload {
        border: 3px dashed #6b6b6b;
        min-height: 100%;
        text-align: center;
        width: 100%;
        display: flex;
        justify-content: center;
        flex-direction: column;
        color: #0d8acd;
        position: relative;
        -webkit-transition: .3s all;
        -moz-transition: .3s all;
        -o-transition: .3s all;
        transition: .3s all;
        border-radius: 10px !important;
        z-index: 9999;
    }

    .area-upload label.label-upload.highlight {
        background-color: #fffdaa;
    }

    .area-upload label.label-upload * {
        pointer-events: none;
    }

    .area-upload input {
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        -webkit-appearance: none;
        opacity: 0;
    }

    rea-upload .lista-uploads .barra {
        background-color: #e6e6e6;
        margin: 10px 0;
        width: 100%;
        position: relative;
    }

    .area-upload .lista-uploads .barra .fill {
        background-color: #a1f7ff;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        min-width: 0;

        -webkit-transition: .2s all;
        -moz-transition: .2s all;
        -o-transition: .2s all;
        transition: .2s all;
    }

    .area-upload .lista-uploads .barra.complete .fill {
        background-color: #bcffdf;
        border-radius: 10px;
        border: 2px dashed;
    }

    .area-upload .lista-uploads .barra .text {
        z-index: 10;
        text-align: center;
        padding: 3px 5px;
        box-sizing: border-box;
        position: relative;
        width: 100%;
        color: black;
        font-size: 12px;
    }

    .area-upload .lista-uploads .barra .text a {
        color: black;
        font-weight: bold;
    }

    .area-upload .lista-uploads .barra.error .fill {
        background-color: #c02929;
        color: white;
        min-width: 100%;
    }

    .area-upload .lista-uploads .barra.error .text {
        color: white;
    }

    .lista-uploads {
        display: flex;
        position: relative;
        top: 0;
        width: 100%;
        height: 100%;
        text-align: center;
        align-items: center;
        flex-direction: column;
        justify-content: center;
        border-radius: 10px !important;
    }
</style>
<div class="d-flex justify-content-center login">

    <div class="card mt-5 text-center cardlogin" style="width: 800px;">

        <div class="card-body">

            <h2 class="titlecard text-start">Crie seu anúncio</h2>

            {{status}}

            <form method="post">
                <div class="row">
                    <div class="col-md-7">
                        <div class="form-group text-start">
                            <label>Título</label>
                            <input type="text" class="form-control" name="titulo" placeholder="Título do anúncio"
                                required autofocus>
                        </div>

                        <div class="form-group my-3 text-start">
                            <label>Descrição</label>
                            <textarea rows="10" name="descricao"
                                placeholder="Cor, tamanho, estado(novo,usado)"></textarea>
                        </div>

                        <div class="form-group my-3 text-start">
                            <label>Categoria</label>
                            <!-- <input type="text" class="form-control" name="categoria" placeholder="Categoria" required> -->
                            <select name="categoria" class="form-select">
                                <!-- <option value="Automóveis">Automóveis</option>
                                <option value="Casa e decoração">Casa e decoração</option>
                                <option value="Eletrônicos">Eletrônicos</option>
                                <option value="Esporte e Lazer">Esporte e Lazer</option>
                                <option value="Kids">Kids</option>
                                <option value="Moda e Beleza">Moda e Beleza</option> -->
                                {{itens_cat}}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group text-start">
                            <label>Adicione fotos</label>
                            <div class="borderdashed88">
                                <div class="area-upload">
                                    <label for="upload-file" class="label-upload">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <div id="text" class="texto">Clique ou arraste o arquivo</div>
                                    </label>
                                    <input type="file" name="file[]" id="upload-file" multiple />

                                    <div class="lista-uploads">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mt-4 text-start">
                            <label>Valor</label>
                            <input type="text" class="form-control" name="preco" id="valor" placeholder="Valor do anúncio"
                                required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group text-start">
                            <label>Forma de envio*</label>
                            <input type="text" class="form-control" name="forma_envio" placeholder="Forma de envio">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group text-start">
                            <label>CEP*</label>
                            <input type="text" class="form-control" name="cep" placeholder="XXXXX-XXX">
                        </div>
                    </div>
                </div>



                <button type="submit" class="btn btnlogin btn-lg btn-danger mt-5">Salvar Anúncio</button>

            </form>
        </div>
    </div>

</div>

<script>
    let drop_ = document.querySelector('.area-upload #upload-file');
    drop_.addEventListener('dragenter', function () {
        document.querySelector('.area-upload .label-upload').classList.add('highlight');
    });
    drop_.addEventListener('dragleave', function () {
        document.querySelector('.area-upload .label-upload').classList.remove('highlight');
    });
    drop_.addEventListener('drop', function () {
        document.querySelector('.area-upload .label-upload').classList.remove('highlight');
    });

    function validarArquivo(file) {
        console.log(file);
        // Tipos permitidos
        var mime_types = ['image/jpeg', 'image/png', 'application/pdf', 'video/mp4'];

        // Validar os tipos
        if (mime_types.indexOf(file.type) == -1) {
            return {
                "error": "O arquivo " + file.name + " não permitido"
            };
        }

        // Apenas 2MB é permitido
        if (file.size > 65 * 1024 * 1024) {
            return {
                "error": file.name + " ultrapassou limite de 65MB"
            };
        }

        // Se der tudo certo
        return {
            "success": "Enviando: " + file.name
        };
    }

    function enviarArquivo(indice, barra) {
        var data = new FormData();
        var request = new XMLHttpRequest();
        document.querySelector(".lista-uploads").style.position = "absolute";
        document.querySelector("#text").style.display = "none";
        //Adicionar arquivo
        data.append('fotosanuncio', document.querySelector('#upload-file').files[indice]);

        // AJAX request finished
        request.addEventListener('load', function (e) {

            //$(".lista-uploads").attr("style", "position:absolute !important")


            console.log(request)
            // Resposta
            if (request.status == 200) {
                barra.querySelector(".text").innerHTML = "<a href=\"#\">Foto(s) enviado com sucesso.</a> <i class=\"fas fa-check\"></i>";
                barra.classList.add("complete");
            } else {
                barra.querySelector(".text").innerHTML = "Erro ao enviar: " + request.response.name;
                barra.classList.add("error");
            }
        });

        // Calcular e mostrar o progresso
        request.upload.addEventListener('progress', function (e) {
            var percent_complete = (e.loaded / e.total) * 100;

            barra.querySelector(".fill").style.minWidth = percent_complete + "%";
        });

        //Resposta em JSON
        request.responseType = 'json';

        // Caminho
        request.open('post', '{{URL}}/uploadfotos');
        request.send(data);
    }
    document.querySelector('#upload-file').addEventListener('change', function () {
        var files = this.files;
        for (var i = 0; i < files.length; i++) {
            var info = validarArquivo(files[i]);
            //Criar barra
            var barra = document.createElement("div");
            var fill = document.createElement("div");
            var text = document.createElement("div");
            barra.appendChild(fill);
            barra.appendChild(text);

            barra.classList.add("barra");
            fill.classList.add("fill");
            text.classList.add("text");

            if (info.error == undefined) {
                text.innerHTML = info.success;
                enviarArquivo(i, barra); //Enviar
            } else {
                text.innerHTML = info.error;
                barra.classList.add("error");
            }

            //Adicionar barra
            document.querySelector('.lista-uploads').appendChild(barra);
        };
    });
    // usa vírgula como separador decimal, ponto como separador de milhar, sempre com 2 casas decimais
    const formatter = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    function mask(e) {
        const input = e.target;
        // elimina tudo que não é dígito
        input.value = input.value.replace(/\D+/g, '');
        if (input.value.length === 0) // se não tem nada preenchido, não tem o que fazer
            return;
        // verifica se ultrapassou a quantidade máxima de dígitos (pegar o valor no dataset)
        const maxDigits = parseInt(input.dataset.maxDigits);
        if (input.value.length > maxDigits) {
            // O que fazer nesse caso? Decidi pegar somente os primeiros dígitos
            input.value = input.value.substring(0, maxDigits);
        }
        // lembrando que o valor é a quantidade de centavos, então precisa dividir por 100
        input.value = formatter.format(parseInt(input.value) / 100);
    }

    document.querySelector('#valor').addEventListener('input', mask);
</script>